package implement;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutput;
import java.io.ObjectOutputStream;
import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;
import java.security.KeyPair;
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.SecureRandom;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.ArrayList;

import com.dropbox.core.DbxClient;
import com.dropbox.core.DbxEntry;
import com.dropbox.core.DbxException;

import data.Databass;
import template.CreateInterface;

public class Create extends UnicastRemoteObject implements CreateInterface {
public Create() throws RemoteException
{
	super();
}

@Override
public int createUser(String name, String pass) throws RemoteException {
	// TODO Auto-generated method stub
	DbxClient cli;
	byte[] pbkeyss=null;
	byte[] prkeyss=null;
	ObjectOutputStream out1,out2,out3;
	ByteArrayOutputStream bout1,bout2,bout3;
	ByteArrayInputStream bin1,bin2,bin3;
	try {
		ArrayList<ShareList> list=new ArrayList();
		/*String xform = "RSA";  
		  KeyPairGenerator kpg = KeyPairGenerator.getInstance("RSA"); 
		  kpg.initialize(2048); 
		    KeyPair kp = kpg.genKeyPair();
		    PublicKey pubk = kp.getPublic();
		    PrivateKey prvk = kp.getPrivate();
		    bout1=new ByteArrayOutputStream();
		    bout2=new ByteArrayOutputStream();
		    bout3=new ByteArrayOutputStream();
		    out1=new ObjectOutputStream(bout1);
		    out2=new ObjectOutputStream(bout2);
		    out3=new ObjectOutputStream(bout3);
		    out1.writeObject(pubk);
		    out2.writeObject(prvk);
		    out3.writeObject(list);
		    bin1=new ByteArrayInputStream(bout1.toByteArray());
		    bin2=new ByteArrayInputStream(bout2.toByteArray());
		    bin3=new ByteArrayInputStream(bout3.toByteArray());
		*/
		Connection con=Databass.getConnect();
		PreparedStatement pst=con.prepareStatement("insert into user value(?,?,?,?,?,0)");
		pst.setString(1,name);
		pst.setString(2,pass);
		pst.setBinaryStream(3,bin1,bout1.toByteArray().length);
		pst.setBinaryStream(4,bin2,bout2.toByteArray().length);
		pst.setBinaryStream(5,bin3,bout3.toByteArray().length);
		if(pst.executeUpdate()>0)
		{
			String dir="C:\\Users\\BharathBabu\\Documents\\";
			cli=Databass.getDbx();
			cli.createFolder("/"+name);
			return 1;	
		}
		else
			return 0;
	} catch (SQLException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
		return 2;
	} catch (NoSuchAlgorithmException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
		return 2;
	} catch (FileNotFoundException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
		return 2;
	} catch (IOException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
		return 2;
	} catch (DbxException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
	return 0;
}
}
